<html>
	<body>
		<!-- Script works if loaded by MAMP -->
		<title>What links here</title>
		<script src="../lib/js/jquery.min.js"></script>
		<!--<script src="jquery.xdomainajax.js"></script>-->
		<link rel="stylesheet" href="../lib/css/scraper.css" rel="stylesheet">
		<script type="text/javascript">

			/* ------------------------------------
			API SOURCE
	        -------------------------------------*/

			var backlinks = 'https://en.wikipedia.org/w/api.php?action=query&list=backlinks&bllimit=500&format=json&bltitle=';

			/* ------------------------------------
	        Contextual functions
	        -------------------------------------*/

			// clean the string
			function string_clean(string) {
				string.replace(/^-+/, '').replace(/-+$/, '').replace('%C7%83', '!').replace(/_/g, ' ').replace('%28', '(').replace('%29', ')').replace('%27', "'");
			}

			// hide graphical elements
			function hide() {
				$('.hide_2').hide
				$('.hide_1').show
			}

	        /* ------------------------------------
			ARTICLES LIST
	        -------------------------------------*/

			var art_list = '../articles/articles.json' // '../articles_test.json'

			// get the list of articles
			$.getJSON(art_list, function(mydata) {

				var parse_art = $.parseHTML(mydata);

				articles = $(mydata)

				//console.log(articles)
			
			})

	        /* ------------------------------------
	        SOURCE - TARGET 
	        -------------------------------------*/


	        // get backlinks list for one article
			function get_source_target(url) {

	            $.ajax(url, {
	                dataType: "jsonp",
	                success: function( wikiResponse ) {

	                	var parse_back = $.parseHTML(wikiResponse); 

	                	back = []
						back = $(wikiResponse.query.backlinks)

						var art_name = url.replace('https://en.wikipedia.org/w/api.php?action=query&list=backlinks&bllimit=500&format=json&bltitle=','')
						
						//var art_name_clean = string_clean(art_name)
						var art_name_clean = art_name.replace(/^-+/, '').replace(/-+$/, '').replace('%C7%83', '!').replace(/_/g, ' ').replace('%28', '(').replace('%29', ')').replace('%27', "'");

						jQuery.each( back, function( i, val ) {

							var cont = val.title 

							$('#content1').append('<span class="red">' + art_name_clean  + '</span>, ' + cont + ',<br/>') 

						})

	                },   
					error : function (xhr, ajaxOptions, thrownError) {
				        console.log(xhr.status);
				        console.log(thrownError);
					}
	            })
	        }    

	        // get backlinks list for all of articles
	        function get_all_source_target() {

	        	$('#source_target').html('Source,Target,<br/>')
	        
				jQuery.each( articles, function( i, val ) {
					
					var title = val // i

					//get_source_target('https://en.wikipedia.org/w/api.php?action=query&list=backlinks&bllimit=500&format=json&bltitle=' + val )  // i
					get_source_target(  backlinks + val )
					
				})

	        	console.log('Done');	
				
				$('.hide_1').hide()
			}

	        /* ------------------------------------
	        ID - LABEL 
	        -------------------------------------*/

	        // get id and labels for all articles
	        function get_all_id_label(url) {

	        	$('#content2').append('Id, Label<br/>')

	        	jQuery.each( articles, function( i, val ) {

	        		val_clean = val.replace(/^-+/, '').replace(/-+$/, '').replace('%C7%83', '!').replace(/_/g, ' ').replace('%28', '(').replace('%29', ')').replace('%27', "'");

	        		$('#content2').append('<span class="red">' + val_clean  + '</span>, ' + val_clean + '<br/>')

	        		//console.log(val)
	        		$('.hide_1').hide()

	        	})
	        }

		</script>

		<main>
			<div id="title" class="hide_1">
				<h1>What links here<h1>
				<h2>Links from other Wikipedia pages</h2>
			</div>
			<div class="box_50">
				<div class="label one hide_1" onclick="get_all_source_target()">
					<span>Get source-target (edges)</span>
				</div>
				<div id="source_target" class="hide_2"></div>
				<div id="content1" class="hide_2" onclick="hide()"></div>
			</div>

			<div class="box_50">
				<div class="label two hide_1" onclick="get_all_id_label()">
					<span>Get id-label (nodes)<span>
				</div>
				<div id="id_label" class="hide_2"></div>				
				<div id="content2" class="hide_2" onclick="hide()"></div>
			</div>

			<div class="clear"></div>
		</main>


	</body>

</html>