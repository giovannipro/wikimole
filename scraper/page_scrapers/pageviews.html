<html>
	<body>
		<!-- Script works if loaded by MAMP -->
		<title>Page views</title>
		<script src="../lib/js/jquery.min.js"></script>
		<script src="../lib/js/jquery.xdomainajax.js"></script>
		<link rel="stylesheet" href="../lib/css/scraper.css" rel="stylesheet">
		<script type="text/javascript">


			var interlink = 'http://localhost:8888/wikimole/scraper/proxy/proxy_interlinks.php?url=nelson_mandela'
			var whatlinks = 'https://en.wikipedia.org/w/api.php?action=query&list=backlinks&bllimit=500&format=json&bltitle=nelson_mandela'

			/*
			console.log(interlink)
			console.log(whatlinks)
			*/

	        /* ------------------------------------
			SOURCE
	        -------------------------------------*/

	        var baseurl = 'http://localhost:8888/wikimole/scraper/proxy/';

	        var proxy = baseurl + 'proxy_pageviews.php' + "?url=" ;

	        var wikilink = 'https://en.wikipedia.org/wiki/';

	        /* ------------------------------------
			ARTICLES LIST
	        -------------------------------------*/

			var art_list = '../articles/articles_test.json' // '../articles.json'

			var list = [
				'https://en.wikipedia.org/wiki/nelson_mandela',
				'https://en.wikipedia.org/wiki/mahatma_gandhi'
			]	

			// get the list of articles
			$.getJSON(art_list, function(mydata) {

				var parse_art = $.parseHTML(mydata);

				articles = $(mydata)

				//console.log( articles )
			
			})

	        /* ------------------------------------
	        GET ONE MONTH
	        -------------------------------------*/

	        var service = "http://stats.grok.se/json/en/"

	       	var date = "201506"

	        var article = "nelson_mandela" //

	        var proxy_link = proxy + service + date + '/' + article

	        function get_one_month_pageview(url) {

	  		    $.ajax({			    	
		           	type: 'GET',
		           	url: url,
		           	processData: true,
		           	//dataType: 'json',
		           	//crossOrigin: true,
		        })
				.done (function (wikiResponse) {

					var parse_pagv = $.parseHTML(wikiResponse); //parseHTML

					//var pag = []; var myJson = ""

					pag = $(wikiResponse)[0].results // 

					//console.log(pag) 

			      	var container = $('#pageviews')

			      	//container.append('[{"article": "' + article + '"},')

			      	/*
			      	function get_one_obj(article) {

			      		var c = []
			      		console.log(c)
						console.log(o)

			      	}
					*/
	

					jQuery.each( pag, function( i, val ) {

						var obj = {},  view = []

						var out =  val.replace('<html><head/><body>','').replace('</body></html>','')

						var output = out + ',<br/>'

						var myObj = $.parseJSON(out)

						var day = myObj.daily_views

						console.log(day)

						//obj.push(view)

						//console.log(obj)


/*

var element = {}, cart = [];
element.id = id;
element.quantity = quantity;
cart.push(element);
*/
						//console.log(day.length)
						//x.push(myObj)

						/*
						$.map(day, function (n) {
						    c.push(n);
						    //o.push(n);
						});
						*/

						for (var i = 0; i < 10; i++) { //daily_views.length
						    $.merge(obj, day); // [i]
 
						};

						//var x = $.map( myObj.daily_views, function( k, v ) { //jQuery.each
						/*var daily_views = jQuery.each( day, function(  k, v ) {

								//var k = v
								//var v = v

								return y =  [k , v]

								c.push(k)

								//$.merge(items, responseData.data.items);

								//var pv_parse = $.parseJSON(pv)
								//new_x = [v , k]
								//console.log (v , k)
								//console.log(i)
								//console.log(v)								
								//$.map( page_views, function( i, val ) { 

								//console.log(k)


						
						})*/

						
						
						function collect() {
							var ret = {};
						  	var len = arguments.length;
						  	for (var i=0; i<len; i++) {
						    	for (var p in arguments[i]) {
						        	ret[p] = arguments[i][p];
						      	}
						    }
						    return ret;
						}
						
						var collect = collect(day)

						//console.log(collect)
						//console.log(x)

						/*
						var new_object = $.extend({}, object1, object2);
						$.extend(true, obj1, obj2);
						*/

						//console.log(myobj)
						
						//console.log ( myObj )
						//console.log (out)

						//container.append(output) 
						//container.append(']')	
						// $('.hide_1').hide()

					})

	
				})
				.error (function (xhr, ajaxOptions, thrownError) {
			        console.log(xhr.status);
			        console.log(thrownError);
			        /*
						200 OK
						301 Moved Permanently
						400 Bad Request
						401 Unauthorized
						403 Forbidden
						404 Not Found
						500 Internal Server Error
						503 Service Unavailable
			        */
				})
			}

			var array = [];

			function get_monthly_pageview(article) {

				var head =   article //'[{"article": "' + article + '"},'

				console.log(head)

				$('#tit').append( $("<div/>").append(head));

				for (i = 1; i < 10; i++) { 

					get_one_month_pageview(service + '20140' + i + '/' + article)

				}

				for (i = 10; i < 13; i++) { 

					get_one_month_pageview(service + '2014' + i + '/' + article)
				}
			}

			/*function get_full_obj (article){
				
				jQuery.each( pag, function( i, val ) {

					

				}
			
			}*/


			//get_full_obj (article)
			get_monthly_pageview(article)

		</script>

		<main>
			<div id="title" class="hide_1">
				<h1>Page views<h1>
				<h2>From 1.12.2013 to 31.07.2015</h2>
			</div>
			<div class="box_100">
				<div class="label one hide_1" onclick="" style="">
					<span>Get pageviews</span>
					<!-- to be sure each edge is downloaded see Firebug > Network > Time column-->
				</div><!-- get_all_source_target()-->
				<div id="tit" class="hide_2"></div>
				<div id="pageviews" class="hide_2"></div>
				<div id="content1" class="hide_2" onclick="hide()"></div>
			</div>

			<!--<div class="box">
				<div class="label two hide_1" onclick="get_id_label()">
					<span>Get id-label (nodes)<span>
				</div>
				<div id="id_label" class="hide_2"></div>				
				<div id="content2" class="hide_2" onclick="hide()"></div>
			</div>-->

			<div class="clear"></div>
		</main>

	</body>
</html>