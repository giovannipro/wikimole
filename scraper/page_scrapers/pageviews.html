<html>
	<body>
		<!-- Script works if loaded by MAMP -->
		<title>Page views</title>
		<script src="../lib/js/jquery.min.js"></script>
		<script src="../lib/js/jquery.xdomainajax.js"></script>
		<link rel="stylesheet" href="../lib/css/scraper.css" rel="stylesheet">
		<script type="text/javascript">

			// var interlink = 'http://localhost:8888/wikimole/scraper/proxy/proxy_interlinks.php?url=nelson_mandela';
			// var whatlinks = 'https://en.wikipedia.org/w/api.php?action=query&list=backlinks&bllimit=500&format=json&bltitle=nelson_mandela';

			var resultsss = {};

	        /* ------------------------------------
			SOURCE
	        -------------------------------------*/

	        var baseurl = 'http://localhost:8888/wikimole/scraper/proxy/';

	        var proxy = baseurl + 'proxy_pageviews.php' + "?url=" ;

	        //var wikilink = 'https://en.wikipedia.org/wiki/';

	        var service = "http://stats.grok.se/json/en/"; // '201506/nelson_mandela

	        //var proxy_service = proxy + service;

	        /* ------------------------------------
			ARTICLES LIST
	        -------------------------------------*/

			var art_list = '../articles/articles_test.json' // '../articles.json'

			var list = [
				'https://en.wikipedia.org/wiki/nelson_mandela',
				'https://en.wikipedia.org/wiki/mahatma_gandhi'
			]	

			// get the list of articles
			$.getJSON(art_list, function(mydata) {

				var parse_art = $.parseHTML(mydata);

				articles = $(mydata)

				//console.log( articles )
			
			})

	        /* ------------------------------------
	        GET ONE MONTH
	        -------------------------------------*/

	       	var date = "201506"
	        var article_a = "nelson_mandela"
	        //var proxy_link = proxy_service + date + '/' + article

	        //function get_one_month_pageview(url) {
	        function get_one_month_pageview(yearString, monthString, article) {

	        	//var url = proxy + service + yearString + '/' + monthString + '/' + article;
	        	var url1 = proxy + service + yearString + monthString +  '/' + article
	        	var url2 = service + yearString + monthString +  '/' + article

	        	console.log(url2)

	  		    $.ajax({			    	
		           	type: 'GET',
		           	url: url2,
		           	processData: true,
		           	dataType: 'json',
		           	crossOrigin: true,
		        })
				.done (function (wikiResponse) {

					//var parse_pagv = $.parseHTML(wikiResponse); 

					pag = $(wikiResponse)[0].results
					console.log(wikiResponse);

			      	var container = $('#pageviews');

			      	//resultsss[dateString] = wikiResponse.daily_views;
			      	resultsss = wikiResponse.daily_views;

					console.log(resultsss);
					console.log(day);
	
				})
				.error (function (xhr, ajaxOptions, thrownError) {
			        console.log(xhr.status);
			        console.log(thrownError);
			        /*
						200 OK
						301 Moved Permanently
						400 Bad Request
						401 Unauthorized
						403 Forbidden
						404 Not Found
						500 Internal Server Error
						503 Service Unavailable
			        */
				})
			}

			//var array = [];

			function get_monthly_pageview(article) {

				//var head =   article //'[{"article": "' + article + '"},'
				console.log(article)

				$('#tit').append( $("<div/>").append(article));

				for (i = 1; i < 10; i++) { 

					//var dateString = '20140' + i;
					var yearString = '2014' ;
					var monthString = '0'+i ;

					get_one_month_pageview(yearString, monthString, article);
					//get_one_month_pageview(service, dateString, article);
					//get_one_month_pageview(service + '20140' + i + '/' + article)

				}

				for (i = 10; i < 13; i++) { 

					var yearString = '2014' ;
					var monthString =  i ;

					get_one_month_pageview(yearString, monthString, article);
				}
			}

			get_monthly_pageview(article_a)

		</script>

		<main>
			<div id="title" class="hide_1">
				<h1>Page views<h1>
				<h2>From 1.12.2013 to 31.07.2015</h2>
			</div>
			<div class="box_100">
				<div class="label one hide_1" onclick="get_monthly_pageview()" style="">
					<span>Get pageviews</span>
					<!-- to be sure each edge is downloaded see Firebug > Network > Time column-->
				</div><!-- get_all_source_target()-->
				<div id="tit" class="hide_2"></div>
				<div id="pageviews" class="hide_2"></div>
				<div id="content1" class="hide_2" onclick="hide()"></div>
			</div>

			<!--<div class="box">
				<div class="label two hide_1" onclick="get_id_label()">
					<span>Get id-label (nodes)<span>
				</div>
				<div id="id_label" class="hide_2"></div>				
				<div id="content2" class="hide_2" onclick="hide()"></div>
			</div>-->

			<div class="clear"></div>
		</main>

	</body>
</html>