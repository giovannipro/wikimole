<html>
	<body>
		<!-- Script works if loaded by MAMP -->
		<title>Page views</title>
		<script src="../lib/js/jquery.min.js"></script>
		<script src="../lib/js/jquery.xdomainajax.js"></script>
		<link rel="stylesheet" href="../lib/css/scraper.css" rel="stylesheet">
		<script type="text/javascript">

			// var interlink = 'http://localhost:8888/wikimole/scraper/proxy/proxy_interlinks.php?url=nelson_mandela';
			// var whatlinks = 'https://en.wikipedia.org/w/api.php?action=query&list=backlinks&bllimit=500&format=json&bltitle=nelson_mandela';

			var yearPV = {};

	        /* ------------------------------------
			SOURCE
	        -------------------------------------*/

	        var baseurl = 'http://localhost:8888/wikimole/scraper/proxy/';

	        var proxy = baseurl + 'proxy_pageviews.php' + "?url=" ;

	        //var wikilink = 'https://en.wikipedia.org/wiki/';

	        var service = "http://stats.grok.se/json/en/"; // '201506/nelson_mandela

	        //var proxy_service = proxy + service;

	        /* ------------------------------------
			ARTICLES LIST
	        -------------------------------------*/

			var art_list = '../articles/articles_test.json' // '../articles.json'

			var list = [
				'https://en.wikipedia.org/wiki/nelson_mandela',
				'https://en.wikipedia.org/wiki/mahatma_gandhi'
			]	

			// get the list of articles
			$.getJSON(art_list, function(mydata) {

				var parse_art = $.parseHTML(mydata);

				articles = $(mydata)

				//console.log( articles )
			
			})

	        /* ------------------------------------
	        GET ONE MONTH
	        -------------------------------------*/

	        var article_a = "nelson_mandela"

	        var container = $('#pageviews');

	        //function get_one_month_pageview(url) {
	        function get_one_month_pageview(yearString, monthString, article, doPrint) { //dateString

	        	var url1 = proxy + service + yearString + monthString +  '/' + article
	        	var url2 = service + yearString + monthString +  '/' + article
	        	//var url3 = proxy + service + dateString +  '/' + article

	        	var url_test = 'http://localhost:8888/wikimole/scraper/lib/test.json'

	        	console.log(url1)

	  		    $.ajax({			    	
		           	type: 'GET',
		           	url: url1,
		           	processData: true,
		           	dataType: 'json', // html
		           	crossOrigin: true,
		        })
				.done (function (wikiResponse) {
					if (!yearPV.hasOwnProperty(yearString)) {
						yearPV[yearString] = {};
					}

					yearPV[yearString][monthString]  = wikiResponse.daily_views; // dateString

					if (doPrint)
						console.log(yearPV);

					container = $('#pageviews')

					jQuery.each( yearPV, function( x ) {
						jQuery.each( x, function( x, y ) {
							container.append ( x + y )
						})
						container.append ( x )						
					})

					//if (undefined) console.log('ciao')
			      	
				})
				.error (function (xhr, ajaxOptions, thrownError) {
			        console.log(xhr.status);
			        console.log(thrownError);
			        /*
						200 OK
						301 Moved Permanently
						400 Bad Request
						401 Unauthorized
						403 Forbidden
						404 Not Found
						500 Internal Server Error
						503 Service Unavailable
			        */
				})
			}

			//var array = [];

			function get_monthly_pageview(article) {

				console.log(article)

				$('.hide_1').hide()

				for (i = 1; i < 10; i++) { // (i = 1; i < 2; i++)

					//var dateString = '20140' + i;
					var yearString = '2014' ;
					var monthString = '0'+i ;

					get_one_month_pageview(yearString, monthString, article);  // dateString
				}

				for (i = 10; i < 13; i++) { // (i = 10; i < 11; i++) 

					//var dateString = '2014' + i;
					var yearString = '2014' ;
					var monthString =  i + '';

					get_one_month_pageview(yearString, monthString, article, monthString === '12'); // dateString
				}
			}

			//get_monthly_pageview(article_a)

		</script>

		<main>
			<div id="title" class="hide_1">
				<h1>Page views<h1>
				<h2>From 1.12.2013 to 31.07.2015</h2>
			</div>
			<div class="box_100">
				<div class="label one hide_1" onclick="get_monthly_pageview(article_a)" style="">
					<span>Get pageviews</span>
					<!-- to be sure each edge is downloaded see Firebug > Network > Time column-->
				</div><!-- get_all_source_target()-->
				<div id="tit" class="hide_2"></div>
				<div id="pageviews" class="hide_2"></div>
				<div id="content1" class="hide_2" onclick="hide()"></div>
			</div>

			<!--<div class="box">
				<div class="label two hide_1" onclick="get_id_label()">
					<span>Get id-label (nodes)<span>
				</div>
				<div id="id_label" class="hide_2"></div>				
				<div id="content2" class="hide_2" onclick="hide()"></div>
			</div>-->

			<div class="clear"></div>
		</main>

	</body>
</html>