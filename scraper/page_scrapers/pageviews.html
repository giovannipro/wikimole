<html>
	<body>
		<!-- Script works if loaded by MAMP -->
		<title>Page views</title>
		<script src="../lib/js/jquery.min.js"></script>
		<script src="../lib/js/jquery.xdomainajax.js"></script>
		<link rel="stylesheet" href="../lib/css/scraper.css" rel="stylesheet">
		<script type="text/javascript">


			var interlink = 'http://localhost:8888/wikimole/scraper/proxy/proxy_interlinks.php?url=nelson_mandela'

			var whatlinks = 'https://en.wikipedia.org/w/api.php?action=query&list=backlinks&bllimit=500&format=json&bltitle=nelson_mandela'

			/*
			console.log(interlink)
			console.log(whatlinks)
			*/

	        /* ------------------------------------
			SOURCE
	        -------------------------------------*/

	        var baseurl = 'http://localhost:8888/wikimole/scraper/proxy/';

	        var proxy = baseurl + 'proxy_pageviews.php' + "?url=" ;

	        var wikilink = 'https://en.wikipedia.org/wiki/';

	        /* ------------------------------------
			ARTICLES LIST
	        -------------------------------------*/

			var art_list = '../articles/articles.json' // '../articles_test.json'

			var list = [
				'https://en.wikipedia.org/wiki/nelson_mandela',
				'https://en.wikipedia.org/wiki/mahatma_gandhi'
			]	

			// get the list of articles
			$.getJSON(art_list, function(mydata) {

				var parse_art = $.parseHTML(mydata);

				articles = $(mydata)

				//console.log( articles )
			
			})

	        /* ------------------------------------
	        GET ONE MONTH
	        -------------------------------------*/

	        var service = "http://stats.grok.se/json/en/"

	       	var date = "201506"

	        var article = "nelson_mandela"

	        var proxy_link = proxy + service + date + '/' + article

	        function get_one_month_pageview(url) {

	  		    $.ajax({			    	
		           	type: 'GET',
		           	url: url,
		           	processData: true,
		           	//dataType: 'json',
		           	//crossOrigin: true,
		        })
				.done (function (wikiResponse) {

					var parse_pagv = $.parseHTML(wikiResponse); //parseHTML

					//var pag = []
					var myJson = ""

					pag = $(wikiResponse)[0].results  //.output //[0]   //.eq(1)//.get(0)//.toString //.lenght //.get(0).get[1]//  .innerHTML//

					//console.log(pag) 

			      	var container = $('#pageviews')

			      	//container.append('[{"article": "' + article + '"},')

					jQuery.each( pag, function( i, val ) {

						var pag = []

						var out =  val .replace('<html><head/><body>','').replace('</body></html>','')

						var output = out + ',<br/>'

						//var myJson = $.param( output, true );
						//var myJson = pag.push(output);
						//var myJson = JSON.stringify ( [ output ] );


						console.log (out)
						container.append(output) //append

						//console.log (myJson)
						

						/*
						var out = [];

						out.push( val );

						var output = jQuery.parseJSON(out);
						*/

						//var output =  out + ',' //,<br/>'
						//var output_clean = output.replace('[object Object],','')


						//container.append(out)



						//console.log (output)

						//console.log (output_clean)
						//container.append(output_clean)

						//var json_str = JSON.stringify(output_clean);
						//var json_str = $toJSON(output_clean);
						//var json_str = jQuery.parseJSON(out);

						//var json_str = $.JSON.decode(out)
						

						//console.log(json_str)
						//container.append(json_str)

					})

					//container.append(']')

				// $('.hide_1').hide()

				})
				.error (function (xhr, ajaxOptions, thrownError) {
			        console.log(xhr.status);
			        console.log(thrownError);

			        /*
						200 OK
						301 Moved Permanently
						400 Bad Request
						401 Unauthorized
						403 Forbidden
						404 Not Found
						500 Internal Server Error
						503 Service Unavailable
			        */

				});

			}

			function get_monthly_pageview(article) {

				$('#pageviews').append('[{"article": "' + article + '"},')

				var array = [];

				for (i = 1; i < 10; i++) { 

					//console.log(service + '20140' + i + '/' + article)

					get_one_month_pageview(service + '20140' + i + '/' + article)
				}

				for (i = 10; i < 13; i++) { 

					//console.log(service + '2014' + i + '/' + article)

					get_one_month_pageview(service + '2014' + i + '/' + article)
				}

				//$('#pageviews').append('{"article": ' + article + '},')

								
				//container.append(']')

				/*
				jQuery.each( articles, function( i, val ) {

					get_one_month_pageview(proxy_link)

					console.log(articles)

				})
				*/

			}

			//get_one_month_pageview(proxy_link)
			get_monthly_pageview(article)
			//get_monthly_pageview(whatlinks)

		</script>

		<main>
			<div id="title" class="hide_1">
				<h1>Page views<h1>
				<h2>From 1.12.2013 to 31.07.2015</h2>
			</div>
			<div class="box_100">
				<div class="label one hide_1" onclick="" style="">
					<span>Get pageviews</span>
					<!-- to be sure each edge is downloaded see Firebug > Network > Time column-->
				</div><!-- get_all_source_target()-->
				<div id="pageviews" class="hide_2"></div>
				<div id="content1" class="hide_2" onclick="hide()"></div>
			</div>

			<!--<div class="box">
				<div class="label two hide_1" onclick="get_id_label()">
					<span>Get id-label (nodes)<span>
				</div>
				<div id="id_label" class="hide_2"></div>				
				<div id="content2" class="hide_2" onclick="hide()"></div>
			</div>-->

			<div class="clear"></div>
		</main>

	</body>
</html>