<html>
	<body>
		<!-- Script works if loaded by MAMP -->
		<title>Internal factors</title>
		<script src="../lib/js/jquery.min.js"></script>
		<script src="../lib/js/jquery.xdomainajax.js"></script>
		<link rel="stylesheet" href="../lib/css/scraper.css" rel="stylesheet">
		<script type="text/javascript">

	        /* ------------------------------------
			SOURCE
	        -------------------------------------*/

	        var baseurl = 'http://localhost:8888/wikimole/scraper/proxy/';
	        var proxy = baseurl + 'proxy_internal-factors.php' + "?url=" ;
	        var wikilink = 'https://en.wikipedia.org/wiki/';


	        /* ------------------------------------
			ARTICLES LIST
	        -------------------------------------*/

	        var art = 'nelson_mandela' // 'Childbirth_in_Benin'

			var art_list = '../articles/articles_test.json' // '../articles.json'

			var list = [
				'https://en.wikipedia.org/wiki/nelson_mandela',
				'https://en.wikipedia.org/wiki/mahatma_gandhi'
			]	

			$.getJSON(art_list, function(mydata) {

				var parse_art = $.parseHTML(mydata);

				articles = $(mydata)
				// console.log( articles )
			
			})

	        /* ------------------------------------
	        REFERENCES
	        -------------------------------------*/

	        

	        console.log(proxy + wikilink + art) 
 
			function get_references(url) {
			    
			    $.ajax({			    	
		           	type: 'GET',
		           	url: proxy + wikilink + url,
		           	processData: true,
		           	//dataType: 'json',
		           	//crossOrigin: true,
		        })
		        .done (function (get_ref) {

		        	var parsedata_func = $.parseHTML(get_ref);

		        	get = []
					get = ($(parsedata_func).find('#mw-content-text').find('.references').find('li'))
						//.find('.reflist').find('li').find('.citation'))
						//.find('.external'))
					//.find('li').find('.reference')) //.a  //($(parsedata_func).find('#content').find('.references'))    // .find('li') .find('references')

					//console.log(get) 

					arr = []

					sum = 0;

		        	jQuery.each( get, function( i, val ) {

		        		txt = $(this).prop('outerHTML')

		        		container = $('#source_target')
		        		/*container.append('<span>' + i + '-'  + txt +  '</span><br/>' )*/

		        		sum++;

		        		

		        	})

		        	console.log(url + '-' + sum)
		        	container.append(url + ', ' + sum)

					//console.log(arr)
					
					/*
					jQuery.each( get, function( i, val ) {

						console.log(get) 

						//var cont = val;			

						//var url_clean = url.replace('https://en.wikipedia.org/wiki/','').replace(/^-+/, '').replace(/-+$/, '').replace('%C7%83', '!').replace(/_/g, ' ').replace('%28', '(').replace('%29', ')').replace('%27', "'");

						if ( val == '') {
							return ''
						}
						else {

							//container.append ('<span class="red">' + url_clean + '</span>, ' + cont + '</br>' ) // cont

							console.log(get) // i + ' ' + val 
						}

					})

*/

					$('.hide_1').hide()

				})
				.error (function (xhr, ajaxOptions, thrownError) {
			        console.log(xhr.status);
			        console.log(thrownError);
				});

			}

	        // get backlinks list for one article
			function get_source_target() {

				$('#source_target').html('Source,Target<br/>')

				jQuery.each( articles, function( i, val ) { //  list

					//var link = val
					scrape_interlinks( val )
					//console.log( i )

				})	

				// console.log('Done');	
	
			}

			/* ------------------------------------
	        ID - LABEL 
	        -------------------------------------*/

	        /*
	       	// get id and labels for all articles
	        function get_id_label(url) {

	        	$('#content2').append('Id,Label<br/>')

	        	jQuery.each( articles, function( i, val ) {

	        		val_clean = val.replace(/^-+/, '').replace(/-+$/, '').replace('%C7%83', '!').replace(/_/g, ' ').replace('%28', '(').replace('%29', ')').replace('%27', "'");

	        		$('#content2').append('<span class="red">' + val_clean  + '</span>, ' + val_clean + '<br/>')

	        		//console.log(val)
	        		$('.hide_1').hide()

	        	})
	        }
	        */


		get_references(art)


		</script>

		<main>
			<div id="title" class="hide_1">
				<h1>Internal factors<h1>
				<!--<h2>Links to other Wikipedia pages</h2>-->
			</div>
			<div class="box_50">
				<div class="label one hide_1" onclick="get_references()">
					<span>Get source-target (edges)</span>
					<!-- to be sure each edge is downloaded see Firebug > Network > Time column-->
				</div><!-- get_all_source_target()-->
				<div id="source_target" class="hide_2"></div>
				<div id="content1" class="hide_2" onclick="hide()"></div>
			</div>

			<div class="box_50">
				<div class="label two hide_1" onclick="get_id_label()">
					<span>Get id-label (nodes)<span>
				</div>
				<div id="id_label" class="hide_2"></div>				
				<div id="content2" class="hide_2" onclick="hide()"></div>
			</div>

			<div class="clear"></div>
		</main>

	</body>
</html>


<!--

Function for call the proxy
http://goobbe.com/questions/2928320/how-to-call-more-than-one-url-from-one-button-in-jquery-ajax


Convertitore Unix timestamp to Readable Date/time
http://www.onlineconversion.com/unix_time.htm

http://www.4guysfromrolla.com/articles/102710-1.aspx


-->