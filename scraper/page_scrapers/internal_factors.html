<html>
	<body>
		<!-- Script works if loaded by MAMP -->
		<title>Internal factors</title>
		<script src="../lib/js/jquery.min.js"></script>
		<script src="../lib/js/jquery.xdomainajax.js"></script>
		<link rel="stylesheet" href="../lib/css/scraper.css" rel="stylesheet">
		<script type="text/javascript">

	        /* ------------------------------------
			SOURCE
	        -------------------------------------*/

	        var baseurl = 'http://localhost:8888/wikimole/scraper/proxy/';
	        var proxy = baseurl + 'proxy_internal-factors.php' + "?url=" ;
	        var wikilink = 'https://en.wikipedia.org/wiki/';


	        /* ------------------------------------
			ARTICLES LIST
	        -------------------------------------*/

	        var art = 'mahatma_gandhi' //nelson_mandela' // 'Childbirth_in_Benin'

			var art_list = '../articles/articles.json' // '../articles_test.json'

			var list = [
				'nelson_mandela', //https://en.wikipedia.org/wiki/
				'mahatma_gandhi' //https://en.wikipedia.org/wiki/
			]	

			$.getJSON(art_list, function(mydata) {

				//var parse_art = $.parseHTML(mydata);

				articles = $(mydata)
				//console.log( articles )
			
			})

			console.log(proxy + wikilink + art) 

	        /* ------------------------------------
	        REFERENCES
	        -------------------------------------*/

	        //var resultsss = {};
 
			function get_references(url) {
			    
			    $.ajax({			    	
		           	type: 'GET',
		           	url: proxy + wikilink + url,
		           	processData: true,
		           	//dataType: 'json',
		           	//crossOrigin: true,
		        })
		        .done (function (get_ref) {

		        	var parsedata_func = $.parseHTML(get_ref);

		        	get = []
					get = ($(parsedata_func).find('#mw-content-text').find('.references').find('li'))

					sum = 0;

					var url_clean = url.replace('https://en.wikipedia.org/wiki/','').replace(/^-+/, '').replace(/-+$/, '').replace('%C7%83', '!').replace(/_/g, ' ').replace('%28', '(').replace('%29', ')').replace('%27', "'");

		        	jQuery.each( get, function( i, val ) {

		        		txt = $(this).prop('outerHTML')

		        		container = $('#source_target')

		        		sum++;

		        	})

		        	//resultsss[url] = sum
		        	//console.log(resultsss)

		        	console.log(url_clean + ':' + sum)
		        	container.append(url_clean + ', ' + sum + '</br>')	        	

					$('.hide_1').hide()

				})
				.error (function (xhr, ajaxOptions, thrownError) {
			        console.log(xhr.status);
			        console.log(thrownError);
				});

			}

			function get_all_references() {

				//$('#source_target').html('Source,Target<br/>')
				jQuery.each( articles, function( i, val ) {  //articles;   // art_list; list 

					get_references(val)
					//console.log(resultsss)
					//console.log(val)
					//console.log(art_list)

				})	

			}

			/* ------------------------------------
	        SEE ALSO
	        -------------------------------------*/

			function get_seeAlso(url) {
			    
			    $.ajax({			    	
		           	type: 'GET',
		           	url: proxy + wikilink + url,
		           	processData: true,
		           	//dataType: 'json',
		           	//crossOrigin: true,
		        })
		        .done (function (get_ref) {

		        	var parsedata_func = $.parseHTML(get_ref);

		        	get = []
					get = ($(parsedata_func).find('#mw-content-text').find('#See_also').closest( "h2" ).next().find('li'))  //.find('ul')) //.find('.div-col').find('li').find('a'))   //; .find('.references').find('li'))

					sum = 0;

					var url_clean = url.replace('https://en.wikipedia.org/wiki/','').replace(/^-+/, '').replace(/-+$/, '').replace('%C7%83', '!').replace(/_/g, ' ').replace('%28', '(').replace('%29', ')').replace('%27', "'");

					container = $('#source_target')

		        	jQuery.each( get, function( i, val ) {

		        		txt = $(this).prop('outerHTML')

		        		sum++;

		        		/*if (val == 0) {
		        			return '0'
		        		}*/

		        		//console.log(val)
		        		//console.log(url)

		        	})

		        	//resultsss[url] = sum
		        	//console.log(resultsss)

		        	console.log(url_clean + ':' + sum)
		        	container.append(url_clean + ', ' + sum + '</br>')	        	

					$('.hide_1').hide()

				})
				.error (function (xhr, ajaxOptions, thrownError) {
			        console.log(xhr.status);
			        console.log(thrownError);
				});

			}

			function get_all_seeAlso() {

				//$('#source_target').html('Source,Target<br/>')
				jQuery.each( articles, function( i, val ) {  //list; articles;  art_list; list 

					get_seeAlso(val)
					//console.log(resultsss)
					//console.log(val)
					//console.log(art_list)

				})	

			}



		</script>

		<main>
			<div id="title" class="hide_1">
				<h1>Internal factors<h1>
				<!--<h2>Links to other Wikipedia pages</h2>-->
			</div>
			<div class="box_50">
				<div class="label one hide_1" onclick="get_all_references()">
					<span>Get references</span>
					<!-- to be sure each edge is downloaded see Firebug > Network > Time column-->
				</div><!-- get_all_source_target()-->
				<div id="source_target" class="hide_2"></div>
				<div id="content1" class="hide_2" onclick="hide()"></div>
			</div>

			<div class="box_50">
				<div class="label two hide_1" onclick="get_all_seeAlso()">
					<span>Get see also<span>
				</div>
				<div id="id_label" class="hide_2"></div>				
				<div id="content2" class="hide_2" onclick="hide()"></div>
			</div>

			<div class="clear"></div>
		</main>

	</body>
</html>


<!--

Function for call the proxy
http://goobbe.com/questions/2928320/how-to-call-more-than-one-url-from-one-button-in-jquery-ajax


Convertitore Unix timestamp to Readable Date/time
http://www.onlineconversion.com/unix_time.htm

http://www.4guysfromrolla.com/articles/102710-1.aspx


-->